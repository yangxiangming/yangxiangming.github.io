---
layout: post
title:  "PHP 获取IP"
date:   2016-06-27 16:53:05 +0800
categories: notes
author: yangxiangming
tags: [php, ip]
---

简述通过`PHP`获取客户端&服务端`IP`
<!-- more -->
`PHP`中的与定义变量`$_SERVER`服务器和执行环境信息，是一个包含了诸如头信息`header`、路径`path`、以及脚本位置`script locations`等等信息的数组。这个数组中的项目由`Web`服务器创建，不能保证每个服务器都提供全部项目；服务器可能会忽略一些，或者提供一些没有在这里列举出来的项目。如下我们就根据`$_SERVER`中的参数获取对应`IP`。

```php
<?php
/**
 * 获取客户端IP
 */
function getClientIp(){
  if(isset($_SERVER["HTTP_CLIENT_IP"]) and strcasecmp($_SERVER["HTTP_CLIENT_IP"], "unknown")){
    return $_SERVER["HTTP_CLIENT_IP"];
  }
  if(isset($_SERVER["HTTP_X_FORWARDED_FOR"]) and strcasecmp($_SERVER["HTTP_X_FORWARDED_FOR"], "unknown")){
    return $_SERVER["HTTP_X_FORWARDED_FOR"];
  }
  if(isset($_SERVER["REMOTE_ADDR"])){
    return $_SERVER["REMOTE_ADDR"];
  }
  return "";
}

/**
 * 获取服务端IP
 */
function getServerIp(){
  if (isset($_SERVER)) {
    if($_SERVER['SERVER_ADDR']) {
      $server_ip = $_SERVER['SERVER_ADDR'];
    } else {
      $server_ip = $_SERVER['LOCAL_ADDR'];
    }
  } else {
    $server_ip = getenv('SERVER_ADDR');
  }
  return $server_ip;
}
```

具体`PHP`中`$_SERVER`的用法请参考[$_SERVER](http://php.net/manual/zh/reserved.variables.server.php)
